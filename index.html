<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å¤‡å¿˜å½• - Appleé£æ ¼</title>
    <!-- PWAç›¸å…³ -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007aff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ“</text></svg>">
</head>
<body class="light-theme">
    <!-- ç™»å½•ç•Œé¢ä¿æŒä¸å˜ -->
    <div id="login-screen" class="screen">
        <!-- ... åŸæœ‰ç™»å½•ä»£ç  ... -->
    </div>

    <!-- ä¸»åº”ç”¨ç•Œé¢ -->
    <div id="app-screen" class="screen hidden">
        <!-- ä¾§è¾¹æ æ–°å¢ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span id="user-email">user@example.com</span>
                </div>
                <button id="new-memo-btn" class="btn-new-memo">
                    <i class="fas fa-plus"></i> æ–°å»ºå¤‡å¿˜å½•
                </button>
            </div>
            
            <!-- æœç´¢æ  -->
            <div class="search-bar">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="æœç´¢å¤‡å¿˜å½•">
            </div>
            
            <!-- æ–‡ä»¶å¤¹ -->
            <div class="folders">
                <div class="folder active" data-folder="all">
                    <i class="fas fa-inbox"></i>
                    <span>æ‰€æœ‰å¤‡å¿˜å½•</span>
                    <span id="all-count" class="count">0</span>
                </div>
                <div class="folder" data-folder="favorites">
                    <i class="fas fa-star"></i>
                    <span>æ”¶è—</span>
                    <span id="favorites-count" class="count">0</span>
                </div>
                <div class="folder" data-folder="reminders">
                    <i class="fas fa-bell"></i>
                    <span>æé†’</span>
                    <span id="reminders-count" class="count">0</span>
                </div>
                <div class="folder" data-folder="trash">
                    <i class="fas fa-trash"></i>
                    <span>åƒåœ¾æ¡¶</span>
                    <span id="trash-count" class="count">0</span>
                </div>
            </div>
            
            <!-- æ ‡ç­¾éƒ¨åˆ† -->
            <div class="tags-section">
                <h3>æ ‡ç­¾</h3>
                <div id="tags-list"></div>
                <button id="new-tag-btn" class="btn-new-tag">
                    <i class="fas fa-plus"></i> æ–°å»ºæ ‡ç­¾
                </button>
            </div>
            
            <!-- ä¾§è¾¹æ åº•éƒ¨ -->
            <div class="sidebar-footer">
                <button id="theme-toggle" class="btn-theme">
                    <i class="fas fa-moon"></i> æš—é»‘æ¨¡å¼
                </button>
                <button id="sync-btn" class="btn-sync">
                    <i class="fas fa-sync-alt"></i> åŒæ­¥
                    <span id="sync-status" class="sync-status"></span>
                </button>
                <button id="logout-btn" class="btn-logout">
                    <i class="fas fa-sign-out-alt"></i> é€€å‡ºç™»å½•
                </button>
            </div>
        </div>
        
        <div class="main-content">
            <!-- å¤‡å¿˜å½•åˆ—è¡¨ -->
            <div class="memos-list">
                <div class="memos-header">
                    <h2 id="current-folder">æ‰€æœ‰å¤‡å¿˜å½•</h2>
                    <div class="view-controls">
                        <button id="list-view-btn" class="view-btn active">
                            <i class="fas fa-list"></i>
                        </button>
                        <button id="grid-view-btn" class="view-btn">
                            <i class="fas fa-th-large"></i>
                        </button>
                    </div>
                </div>
                
                <div id="memos-container">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- ç¼–è¾‘å™¨åŒºåŸŸ -->
            <div class="memo-editor">
                <div class="editor-header">
                    <input type="text" id="memo-title" placeholder="æ ‡é¢˜">
                    <div class="editor-actions">
                        <button id="favorite-btn" class="icon-btn" title="æ”¶è—">
                            <i class="far fa-star"></i>
                        </button>
                        <button id="lock-btn" class="icon-btn" title="é”å®š">
                            <i class="far fa-lock"></i>
                        </button>
                        <button id="reminder-btn" class="icon-btn" title="è®¾ç½®æé†’">
                            <i class="far fa-bell"></i>
                        </button>
                        <button id="delete-btn" class="icon-btn" title="åˆ é™¤">
                            <i class="far fa-trash-alt"></i>
                        </button>
                        <button id="share-btn" class="icon-btn" title="åˆ†äº«">
                            <i class="fas fa-share"></i>
                        </button>
                        <button id="more-btn" class="icon-btn" title="æ›´å¤š">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>
                    </div>
                </div>
                
                <!-- é™„ä»¶å·¥å…·æ  -->
                <div class="attachments-toolbar">
                    <button id="attach-image-btn" class="attach-btn">
                        <i class="fas fa-image"></i> å›¾ç‰‡
                    </button>
                    <button id="attach-file-btn" class="attach-btn">
                        <i class="fas fa-paperclip"></i> æ–‡ä»¶
                    </button>
                    <button id="attach-camera-btn" class="attach-btn">
                        <i class="fas fa-camera"></i> ç›¸æœº
                    </button>
                </div>
                
                <div class="editor-toolbar">
                    <!-- åŸæœ‰å·¥å…·æ æŒ‰é’® -->
                    <button class="tool-btn" data-command="bold" title="åŠ ç²—">
                        <i class="fas fa-bold"></i>
                    </button>
                    <button class="tool-btn" data-command="italic" title="æ–œä½“">
                        <i class="fas fa-italic"></i>
                    </button>
                    <button class="tool-btn" data-command="underline" title="ä¸‹åˆ’çº¿">
                        <i class="fas fa-underline"></i>
                    </button>
                    <button class="tool-btn" data-command="insertUnorderedList" title="é¡¹ç›®ç¬¦å·">
                        <i class="fas fa-list-ul"></i>
                    </button>
                    <button class="tool-btn" data-command="insertOrderedList" title="ç¼–å·åˆ—è¡¨">
                        <i class="fas fa-list-ol"></i>
                    </button>
                    <button class="tool-btn" data-command="createLink" title="æ’å…¥é“¾æ¥">
                        <i class="fas fa-link"></i>
                    </button>
                    <div class="tag-selector">
                        <select id="tag-select">
                            <option value="">æ·»åŠ æ ‡ç­¾...</option>
                        </select>
                    </div>
                </div>
                
                <!-- é™„ä»¶é¢„è§ˆåŒº -->
                <div id="attachments-preview" class="attachments-preview">
                    <!-- é™„ä»¶é¢„è§ˆå°†åŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <!-- ç¼–è¾‘å™¨å†…å®¹ -->
                <div class="editor-content">
                    <div id="memo-content" contenteditable="true" placeholder="å¼€å§‹è¾“å…¥..."></div>
                </div>
                
                <div class="editor-footer">
                    <div class="memo-info">
                        <span id="char-count">0 å­—ç¬¦</span>
                        <span id="last-saved">ä»æœªä¿å­˜</span>
                        <span id="sync-status-badge" class="sync-badge offline">
                            <i class="fas fa-wifi-slash"></i> ç¦»çº¿
                        </span>
                    </div>
                    <button id="save-btn" class="btn-save">
                        <i class="fas fa-save"></i> ä¿å­˜
                    </button>
                </div>
            </div>
        </div>
        
        <!-- æ‰€æœ‰æ¨¡æ€æ¡† -->
        <div id="new-tag-modal" class="modal hidden">
            <!-- ... åŸæœ‰ä»£ç  ... -->
        </div>
        
        <div id="more-options-modal" class="modal hidden">
            <!-- ... åŸæœ‰ä»£ç  ... -->
        </div>
        
        <!-- æé†’è®¾ç½®æ¨¡æ€æ¡† -->
        <div id="reminder-modal" class="modal hidden">
            <div class="modal-content">
                <h3>è®¾ç½®æé†’</h3>
                <div class="reminder-options">
                    <div class="reminder-option">
                        <input type="radio" id="reminder-none" name="reminder" value="none" checked>
                        <label for="reminder-none">æ— æé†’</label>
                    </div>
                    <div class="reminder-option">
                        <input type="radio" id="reminder-later" name="reminder" value="later">
                        <label for="reminder-later">ç¨åæé†’</label>
                    </div>
                    <div class="reminder-option">
                        <input type="radio" id="reminder-tomorrow" name="reminder" value="tomorrow">
                        <label for="reminder-tomorrow">æ˜å¤©</label>
                    </div>
                    <div class="reminder-option">
                        <input type="radio" id="reminder-custom" name="reminder" value="custom">
                        <label for="reminder-custom">è‡ªå®šä¹‰æ—¶é—´</label>
                        <input type="datetime-local" id="custom-reminder-time" class="hidden">
                    </div>
                </div>
                <div class="modal-actions">
                    <button id="cancel-reminder-btn" class="btn-secondary">å–æ¶ˆ</button>
                    <button id="save-reminder-btn" class="btn-primary">è®¾ç½®</button>
                </div>
            </div>
        </div>
        
        <!-- åˆ†äº«æ¨¡æ€æ¡† -->
        <div id="share-modal" class="modal hidden">
            <div class="modal-content">
                <h3>åˆ†äº«å¤‡å¿˜å½•</h3>
                <div class="share-options">
                    <div class="share-option">
                        <input type="radio" id="share-private" name="share-type" value="private" checked>
                        <label for="share-private">ä»…æˆ‘å¯è§</label>
                    </div>
                    <div class="share-option">
                        <input type="radio" id="share-link" name="share-type" value="link">
                        <label for="share-link">ç”Ÿæˆåˆ†äº«é“¾æ¥</label>
                    </div>
                    <div class="share-option">
                        <input type="radio" id="share-email" name="share-type" value="email">
                        <label for="share-email">é€šè¿‡é‚®ä»¶åˆ†äº«</label>
                        <input type="email" id="share-email-input" placeholder="è¾“å…¥é‚®ç®±åœ°å€" class="hidden">
                    </div>
                </div>
                <div id="share-link-container" class="hidden">
                    <input type="text" id="share-link-input" readonly>
                    <button id="copy-link-btn" class="btn-secondary">
                        <i class="fas fa-copy"></i> å¤åˆ¶é“¾æ¥
                    </button>
                </div>
                <div class="modal-actions">
                    <button id="cancel-share-btn" class="btn-secondary">å–æ¶ˆ</button>
                    <button id="confirm-share-btn" class="btn-primary">åˆ†äº«</button>
                </div>
            </div>
        </div>
        
        <!-- é™„ä»¶ä¸Šä¼ æ¨¡æ€æ¡† -->
        <div id="upload-modal" class="modal hidden">
            <div class="modal-content">
                <h3>ä¸Šä¼ é™„ä»¶</h3>
                <div class="upload-area" id="upload-area">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»é€‰æ‹©</p>
                    <input type="file" id="file-input" multiple accept="image/*,.pdf,.doc,.docx,.txt">
                </div>
                <div class="upload-progress hidden" id="upload-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <span id="progress-text">0%</span>
                </div>
                <div class="modal-actions">
                    <button id="cancel-upload-btn" class="btn-secondary">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
        
        <!-- å›æ”¶ç«™æ¢å¤æ¨¡æ€æ¡† -->
        <div id="trash-modal" class="modal hidden">
            <div class="modal-content">
                <h3>å›æ”¶ç«™</h3>
                <div id="trash-list" class="trash-list">
                    <!-- å›æ”¶ç«™é¡¹ç›®å°†åŠ¨æ€ç”Ÿæˆ -->
                </div>
                <div class="modal-actions">
                    <button id="empty-trash-btn" class="btn-danger">
                        <i class="fas fa-trash"></i> æ¸…ç©ºå›æ”¶ç«™
                    </button>
                    <button id="close-trash-btn" class="btn-secondary">å…³é—­</button>
                </div>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥ -->
    <div id="notification" class="notification hidden">
        <span id="notification-text"></span>
    </div>

    <!-- è„šæœ¬ -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="auth.js"></script>
    <script src="app.js"></script>
    <script>
        // æ³¨å†ŒService Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(registration => {
                    console.log('Service Worker æ³¨å†ŒæˆåŠŸ:', registration);
                })
                .catch(error => {
                    console.log('Service Worker æ³¨å†Œå¤±è´¥:', error);
                });
        }
        
        // æ£€æµ‹ç½‘ç»œçŠ¶æ€
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        
        function updateOnlineStatus() {
            const badge = document.getElementById('sync-status-badge');
            if (navigator.onLine) {
                badge.innerHTML = '<i class="fas fa-wifi"></i> åœ¨çº¿';
                badge.className = 'sync-badge online';
            } else {
                badge.innerHTML = '<i class="fas fa-wifi-slash"></i> ç¦»çº¿';
                badge.className = 'sync-badge offline';
            }
        }
        
        // åˆå§‹åŒ–ç½‘ç»œçŠ¶æ€
        updateOnlineStatus();
    </script>
</body>
</html>